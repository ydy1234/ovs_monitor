//-
  Open vMonitor is a WEB-based tool for monitoring and troubleshooting Open vSwitch
  Copyright (C) 2014-2016  PLVision
  Ihor Chumak, Roman Gotsiy

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.

  PLVision, developers@plvision.eu

extends index
block maincontent
  .devices
  each br in bridges
    - //var led_dimensions  = { width : 16, height : 8 };
    - //var len = br.ports.length < 10 ? 10 : br.ports.length % 2 ? br.ports.length + 1 : br.ports.length;
    - //var panel_dimensions = { width : ((len / 2 >> 0) + 1 )*3 + (len / 2 >> 0)*led_dimensions.width + 2, height : 2*3 + 2*led_dimensions.height + 8 + 2 };
    - //var view_dimensions = { width : panel_dimensions.width + 2*8, height : panel_dimensions.height + 2*12 };

    .panel.panel-default
      .panel-heading
        |Bridge: #{br.name}
      .panel-body
        .switch_view(id="#{br.name}")
        - //svg(height="#{view_dimensions.height}", width="#{view_dimensions.width}")
          - //rect(x=0, y=0, width=view_dimensions.width, height=view_dimensions.height, style="fill:rgb(247,244,251); stroke: black;")
          - //rect(x=8, y=12, width=panel_dimensions.width, height=panel_dimensions.height, style="fill:rgb(247,244,251); stroke: black;")
          - //var x = 12
          - //var y = 16
          - //num = 0
          - //var line = (len / 2 >> 0);
          - //each port in br.ports
            - //if (num == line)
              - //num = 0;
              - //y += 2*led_dimensions.height;
              - //x = 12;
            - //else
            - //var color = port.link_state == "up" ? "rgb(118,181,18)" : "rgb(228,77,58)";
              - //rect.led(x=x, y=y, width=led_dimensions.width, height=led_dimensions.height, style="fill: #{color}; stroke: black;")
                - //title
                  - //|#{port}
              - //x += led_dimensions.width + 3;
              - //num++;
  script.
    $(document).ready(function() {
      draw_switch_view(".switch_view");
    });
